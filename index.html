<!doctype html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Impact Challenge - Oslo üá≥üá¥</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Lime Brand Colors */
      :root {
        --lime-green: #a4d65e;
        --lime-teal: #6eceb2;
        --lime-blue: #00c1de;
        --lime-purple: #7f60ca;
        --lime-pink: #e75d9c;
        --lime-dark: #2c3e50;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #a4d65e 0%,
          /* Lime Green */ #6eceb2 25%,
          /* Lime Teal */ #00c1de 50%,
          /* Lime Blue */ #7f60ca 75%,
          /* Lime Purple */ #6eceb2 100% /* Back to Teal */
        );
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      h1 {
        color: #333;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .subtitle {
        color: #666;
        font-size: 1.2em;
      }

      .period {
        color: #a4d65e; /* Lime gr√∂n */
        font-weight: bold;
        margin-top: 10px;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .card h2 {
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 600;
      }

      .label-optional {
        color: #999;
        font-weight: normal;
        font-size: 0.9em;
      }

      .roles-note {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 12px;
        margin-bottom: 15px;
        border-radius: 5px;
        font-size: 0.95em;
        color: #856404;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border 0.3s;
      }

      select.selected {
        border-color: #90ee90;
        background-color: #f0fff0;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #90ee90;
      }

      button {
        background: linear-gradient(135deg, #a4d65e 0%, #6eceb2 100%);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        transition: transform 0.2s;
      }

      button:hover {
        transform: scale(1.05);
      }

      button:active {
        transform: scale(0.98);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .validation-error {
        color: #ff4444;
        font-size: 0.9em;
        margin-top: 5px;
        display: none;
      }

      .validation-error.show {
        display: block;
      }

      .leaderboard {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .leaderboard h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 1.5em;
      }

      .leaderboard-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        margin: 10px 0;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 5px solid #90ee90;
        transition: transform 0.2s;
      }

      .leaderboard-item:hover {
        transform: translateX(5px);
      }

      .leaderboard-item.winner {
        background: linear-gradient(135deg, #fff2cc 0%, #ffe5a0 100%);
        border-left: 5px solid #ffd700;
        font-weight: bold;
      }

      .name {
        font-size: 1.1em;
        color: #333;
      }

      .points {
        font-size: 1.5em;
        color: #a4d65e; /* Lime gr√∂n */
        font-weight: bold;
      }

      .winner .points {
        color: #ffd700;
      }

      .trophy {
        font-size: 1.5em;
        margin-right: 10px;
      }

      /* ===== AKTIVITETSLOGG - NY FIXAD VERSION ===== */
      .activity-log {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-top: 30px;
      }

      .activity-log h2 {
        margin-bottom: 20px;
      }

      .activity-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 20px;
      }

      .activity-item {
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 5px solid #667eea;
        padding: 15px;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        gap: 10px;
        position: relative;
      }

      .activity-item:hover {
        background: #e9ecef;
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .activity-item .date {
        color: #6c757d;
        font-size: 0.85em;
        font-weight: 500;
      }

      .activity-item .customer {
        font-weight: bold;
        color: #333;
        font-size: 1em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .activity-item .roles {
        color: #495057;
        font-size: 0.85em;
        line-height: 1.5;
        padding: 8px 0;
        border-top: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
      }

      .activity-item .roles strong {
        color: #667eea;
        font-weight: 600;
        display: block;
        margin-bottom: 3px;
      }

      .activity-item .details {
        color: #666;
        font-size: 0.85em;
        line-height: 1.4;
      }

      .activity-item .details .points-badge {
        display: inline-block;
        font-weight: bold;
        margin-left: 5px;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.9em;
      }

      .delete-btn {
        background: #ff4444;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8em;
        font-weight: 600;
        transition: all 0.2s;
        white-space: nowrap;
        align-self: flex-start;
        margin-top: auto;
      }

      .delete-btn:hover {
        background: #cc0000;
        transform: scale(1.05);
      }

      /* Vis mer knapp */
      .show-more-container {
        text-align: center;
        padding: 20px;
      }

      .show-more-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 40px;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .show-more-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .pagination-info {
        color: #666;
        font-size: 0.9em;
        margin-bottom: 10px;
      }

      /* Responsiv design */
      @media (max-width: 1200px) {
        .activity-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .activity-grid {
          grid-template-columns: 1fr;
        }

        .activity-item .customer {
          white-space: normal;
        }

        .delete-btn {
          width: 100%;
        }
      }

      /* Mobilanpassning f√∂r aktivitetslogg */
      @media (max-width: 968px) {
        .activity-item {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .delete-btn {
          width: 100%;
          padding: 12px;
        }
      }

      @media (max-width: 768px) {
        .activity-item .roles {
          font-size: 0.85em;
          line-height: 1.6;
        }

        .activity-item .customer {
          font-size: 1em;
        }
      }

      @media (max-width: 480px) {
        .activity-log {
          padding: 15px;
        }

        .activity-item {
          padding: 15px;
        }

        .activity-item .roles strong {
          display: block;
          margin-bottom: 3px;
        }
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .stat-value {
        font-size: 2.5em;
        font-weight: bold;
        color: #6eceb2; /* Lime turkos */
      }

      .stat-label {
        color: #666;
        margin-top: 5px;
      }

      .winners-section {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-bottom: 30px;
      }

      .winner-boxes {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
      }

      .winner-box {
        background: linear-gradient(135deg, #fff9e6 0%, #ffe5a0 100%);
        padding: 20px;
        border-radius: 10px;
        min-width: 250px;
        text-align: center;
        border: 3px solid #ffd700;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
      }

      .winner-box h4 {
        margin-bottom: 10px;
        color: #333;
      }

      .winner-name {
        font-size: 1.5em;
        font-weight: bold;
        color: #2c3e50; /* ‚Üê M√∂rk text ist√§llet f√∂r guld */
        margin: 10px 0;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
      }

      .prize {
        color: #666;
        margin-top: 10px;
      }

      .delete-btn {
        background: #ff4444;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background 0.2s;
      }

      .delete-btn:hover {
        background: #cc0000;
      }

      .success-message {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #32cd32;
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      .error-message {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff4444;
        color: white;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .grid {
          grid-template-columns: 1fr;
        }

        .stats {
          grid-template-columns: repeat(2, 1fr);
        }

        h1 {
          font-size: 1.8em;
        }

        .winner-boxes {
          flex-direction: column;
          align-items: center;
        }
      }

      /* ===== INFORMATIONSBOX ===== */
      .info-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-top: 30px;
      }

      .info-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 3px solid #90ee90;
      }

      .info-header h2 {
        color: #333;
        font-size: 2em;
      }

      .info-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
      }

      .info-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #667eea;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
      }

      .info-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .info-box h3 {
        color: #333;
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .info-box p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 10px;
      }

      .info-box ul {
        list-style: none;
        padding: 0;
      }

      .info-box ul li {
        color: #666;
        padding: 8px 0;
        padding-left: 25px;
        position: relative;
        line-height: 1.6;
      }

      .info-box ul li:before {
        content: "‚úì";
        position: absolute;
        left: 0;
        color: #32cd32;
        font-weight: bold;
        font-size: 1.2em;
      }

      .info-box ul li strong {
        color: #333;
      }

      .info-box-highlight {
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border-left-color: #32cd32;
      }

      .prize-text {
        font-size: 1.2em;
        font-weight: bold;
        color: #32cd32;
        text-align: center;
        padding: 10px;
        background: white;
        border-radius: 8px;
        margin: 10px 0;
      }

      .prime-link {
        display: inline-block;
        background: linear-gradient(135deg, #a4d65e 0%, #00c1de 100%);
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
        margin-top: 10px;
      }

      .prime-link:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(110, 206, 178, 0.4);
      }

      /* Mobilanpassning f√∂r infobox */
      @media (max-width: 768px) {
        .info-section {
          padding: 20px;
        }

        .info-content {
          grid-template-columns: 1fr;
        }

        .info-header h2 {
          font-size: 1.5em;
        }

        .info-box h3 {
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üèÜ BUSINESS IMPACT CHALLENGE</h1>
        <div class="subtitle">Oslo-kontoret üá≥üá¥</div>
        <div class="period">23.02.2026 - 31.03.2026</div>
      </header>

      <!-- Winners Section -->
      <div class="winners-section">
        <h2 style="text-align: center; margin-bottom: 20px">
          üé¨ VINNENDE TRIO üé¨
        </h2>
        <div class="winner-boxes">
          <div class="winner-box">
            <h4>ü•á PM-VINNER</h4>
            <div class="winner-name" id="pmWinner">-</div>
            <div class="points" id="pmWinnerPoints">0 poeng</div>
            <div class="prize">üéüÔ∏è 2x kinobilletter</div>
          </div>
          <div class="winner-box">
            <h4>ü•á AC-VINNER</h4>
            <div class="winner-name" id="acWinner">-</div>
            <div class="points" id="acWinnerPoints">0 poeng</div>
            <div class="prize">üéüÔ∏è 2x kinobilletter</div>
          </div>
          <div class="winner-box">
            <h4>ü•á KAM-VINNER</h4>
            <div class="winner-name" id="kamWinner">-</div>
            <div class="points" id="kamWinnerPoints">0 poeng</div>
            <div class="prize">üéüÔ∏è 2x kinobilletter</div>
          </div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="totalPoints">-</div>
          <div class="stat-label">Totale poeng</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalActivities">-</div>
          <div class="stat-label">Aktiviteter</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalCustomers">-</div>
          <div class="stat-label">Kunder involvert</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="daysLeft">-</div>
          <div class="stat-label">Dager igjen</div>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="grid">
        <!-- Log Activity Form -->
        <div class="card">
          <h2>üìù Logg aktivitet</h2>

          <div class="roles-note">
            ‚ÑπÔ∏è <strong>Velg minst √©n rolle</strong> (PM, AC eller KAM). Du kan
            velge flere roller for samme aktivitet.
          </div>

          <form id="activityForm">
            <div class="form-group">
              <label>Dato *</label>
              <input type="date" id="date" required />
            </div>
            <div class="form-group">
              <label>Kundenavn *</label>
              <input
                type="text"
                id="customer"
                placeholder="Skriv kundenavn..."
                required
              />
            </div>
            <div class="form-group">
              <label
                >PM (Projektledare)
                <span class="label-optional">- valgfri</span></label
              >
              <select id="pm">
                <option value="">Velg PM (valgfri)...</option>
                <option value="Abiraami Uthayamoorthy">
                  Abiraami Uthayamoorthy
                </option>
                <option value="Anders Smogeli">Anders Smogeli</option>
                <option value="Askild Oddekalv">Askild Oddekalv</option>
                <option value="Aurora Nergaard">Aurora Nergaard</option>
                <option value="Daryush Naqid">Daryush Naqid</option>
                <option value="Emily Storm Muniz">Emily Storm Muniz</option>
                <option value="Henrik Kj√¶rvik">Henrik Kj√¶rvik</option>
                <option value="June Bergum Miltenburg">
                  June Bergum Miltenburg
                </option>
                <option value="Marianne Rynning-T√∏nnesen">
                  Marianne Rynning-T√∏nnesen
                </option>
                <option value="Markus M√∏lkj√¶r Klepelv">
                  Markus M√∏lkj√¶r Klepelv
                </option>
                <option value="Rasmus Tyr√©n">Rasmus Tyr√©n</option>
                <option value="Sander Simensen Aasg√•rd">
                  Sander Simensen Aasg√•rd
                </option>
                <option value="Stine √òksnes Vornes">Stine √òksnes Vornes</option>
                <option value="Wilma √ñrnel√∂w">Wilma √ñrnel√∂w</option>
              </select>
            </div>
            <div class="form-group">
              <label
                >AC (Application Consultant)
                <span class="label-optional">- valgfri</span></label
              >
              <select id="ac">
                <option value="">Velg AC (valgfri)...</option>
                <option value="Birger Hesseberg">Birger Hesseberg</option>
                <option value="Dmitriy Safiullin">Dmitriy Safiullin</option>
                <option value="Eirik Lindhaugen">Eirik Lindhaugen</option>
                <option value="Magne Kaurin">Magne Kaurin</option>
                <option value="Marie Hallan">Marie Hallan</option>
                <option value="Sander Jensen">Sander Jensen</option>
                <option value="Simone de Blasio">Simone de Blasio</option>
                <option value="√òivind Harket">√òivind Harket</option>
              </select>
            </div>
            <div class="form-group">
              <label
                >KAM / Sales (Key Account Manager)
                <span class="label-optional">- valgfri</span></label
              >
              <select id="kam">
                <option value="">Velg KAM/Sales (valgfri)...</option>
                <option value="Frode Berg">Frode Berg</option>
                <option value="Mads Skraastad">Mads Skraastad (KAM)</option>
                <option value="Nicklas Weldingh">Nicklas Weldingh</option>
                <option value="Nora Sekse">Nora Sekse (KAM)</option>
                <option value="Olav Vetterstad">Olav Vetterstad</option>
                <option value="Peter Ramskjell Jessen">
                  Peter Ramskjell Jessen
                </option>
              </select>
              <div id="rolesError" class="validation-error">
                ‚ö†Ô∏è Velg minst √©n rolle (PM, AC eller KAM)
              </div>
            </div>
            <div class="form-group">
              <label>Aktivitet *</label>
              <select id="activity" required>
                <option value="">Velg aktivitet...</option>
                <option value="1">Kunde svarte p√• skjema (1 poeng)</option>
                <option value="2">
                  Business Impact m√∏te + dokumentert (2 poeng)
                </option>
                <option value="3">Konkrete KPI-er satt (3 poeng)</option>
              </select>
            </div>
            <button type="submit" id="submitBtn">‚ûï Legg til aktivitet</button>
          </form>
        </div>

        <!-- Leaderboards -->
        <div>
          <div class="leaderboard">
            <h3>üèÜ Projektledare (PM)</h3>
            <div id="pmLeaderboard" class="loading">Laster data...</div>
          </div>

          <div class="leaderboard">
            <h3>üéØ Application Consultants (AC)</h3>
            <div id="acLeaderboard" class="loading">Laster data...</div>
          </div>

          <div class="leaderboard">
            <h3>üíº Key Account Managers (KAM)</h3>
            <div id="kamLeaderboard" class="loading">Laster data...</div>
          </div>
        </div>
      </div>

      <!-- Activity Log -->
      <div class="activity-log">
        <h2>üìä Aktivitetslogg</h2>
        <div class="pagination-info" id="paginationInfo"></div>
        <div id="activityLog" class="loading">Laster data...</div>
        <div
          class="show-more-container"
          id="showMoreContainer"
          style="display: none"
        >
          <button
            class="show-more-btn"
            id="showMoreBtn"
            onclick="loadMoreActivities()"
          >
            Vis flere aktiviteter ‚Üí
          </button>
        </div>
      </div>

      <!-- ‚úÖ NY INFORMATIONSBOX - L√ÑGG TILL H√ÑR! -->
      <div class="info-section">
        <div class="info-header">
          <h2>üìñ Regler og informasjon</h2>
        </div>

        <div class="info-content">
          <div class="info-box">
            <h3>üéØ M√•l</h3>
            <p>Oslo-kontoret skal bli best p√• Business Impact!</p>
          </div>

          <div class="info-box">
            <h3>üìä Poenggivning</h3>
            <ul>
              <li><strong>1 poeng:</strong> Kunde svarer p√• skjema</li>
              <li>
                <strong>2 poeng:</strong> Business Impact diskuteres i m√∏te +
                dokumenteres
              </li>
              <li>
                <strong>3 bonuspoeng:</strong> Kunde setter konkrete KPI-er
              </li>
            </ul>
          </div>

          <div class="info-box">
            <h3>üìù Logging og poengtelling</h3>
            <ul>
              <li>
                Historikknotat p√• kunde - "Business Impact Answer Received"
              </li>
              <li>
                Logg dine poeng p√• denne poengtavlen ‚Äì Det settes opp en
                oversikt
              </li>
              <li>Poengen telles ut fra om man er involvert p√• ett prosjekt</li>
              <li>
                Eksempel: 6 poeng p√• Kunde AS gir poeng til ansvarlig PM+AC+KAM
                eller PM+KAM
              </li>
              <li>Den PM, AC og KAM som har samlet flest poeng vinner!</li>
            </ul>
          </div>

          <div class="info-box">
            <h3>üèÜ Premie</h3>
            <p><strong>Vinnende trio f√•r premie! üéâ</strong></p>
            <p class="prize-text">2x KINO-BILLETTER TIL VALGFRI FILM! üé¨üçøüéâ</p>
            <p style="margin-top: 15px">
              Total: 6 kinobilletter (2 til hver vinner)
            </p>
          </div>

          <div class="info-box info-box-highlight">
            <h3>üìö Les mer om Business Impact</h3>
            <p>Vil du l√¶re mer om hvordan vi jobber med Business Impact?</p>
            <a
              href="https://prime.lime.tech/departments/delivery/advisingconsultants/businessimpact"
              target="_blank"
              class="prime-link"
            >
              üîó Bes√∏k Lime Prime - Business Impact
            </a>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666">
              (√Öpnes i nytt vindu)
            </p>
          </div>

          <div class="info-box">
            <h3>üìÖ Konkurranseperiode</h3>
            <p><strong>Start:</strong> 23. februar 2026</p>
            <p><strong>Slutt:</strong> 31. mars 2026</p>
            <p style="margin-top: 10px">Lykke til! üöÄ</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        orderBy,
        limit,
        onSnapshot,
        deleteDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyB4Qcax0JchyyGIxdQK_T-IblHC8IDUZ8Y",
        authDomain: "business-impact-oslo.firebaseapp.com",
        projectId: "business-impact-oslo",
        storageBucket: "business-impact-oslo.firebasestorage.app",
        messagingSenderId: "751327960879",
        appId: "1:751327960879:web:e91daff11afdeb21cc8bda",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Global activities array
      let activities = [];

      // Set today's date as default
      document.getElementById("date").valueAsDate = new Date();

      // Activity descriptions
      const activityDescriptions = {
        1: "Kunde svarte p√• skjema",
        2: "Business Impact m√∏te + dokumentert",
        3: "Konkrete KPI-er satt",
      };

      // Add visual feedback when selecting roles
      ["pm", "ac", "kam"].forEach((roleId) => {
        document.getElementById(roleId).addEventListener("change", function () {
          if (this.value) {
            this.classList.add("selected");
          } else {
            this.classList.remove("selected");
          }
          // Hide error if at least one role is selected
          const pmValue = document.getElementById("pm").value;
          const acValue = document.getElementById("ac").value;
          const kamValue = document.getElementById("kam").value;
          if (pmValue || acValue || kamValue) {
            document.getElementById("rolesError").classList.remove("show");
          }
        });
      });

      // Listen to real-time updates from Firestore
      const q = query(
        collection(db, "activities"),
        orderBy("timestamp", "desc"),
        limit(100),
      );

      onSnapshot(
        q,
        (snapshot) => {
          activities = [];
          snapshot.forEach((doc) => {
            activities.push({
              id: doc.id,
              ...doc.data(),
            });
          });
          console.log("Activities updated:", activities.length);
          resetPagination(); // ‚Üê L√ÑGG TILL DENNA RAD!
          updateAll();
        },
        (error) => {
          console.error("Error loading activities:", error);
          showErrorMessage("Feil ved lasting av data. Sjekk konsollen.");
        },
      );

      // Handle form submission
      document
        .getElementById("activityForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Validate at least one role is selected
          const pmValue = document.getElementById("pm").value;
          const acValue = document.getElementById("ac").value;
          const kamValue = document.getElementById("kam").value;

          if (!pmValue && !acValue && !kamValue) {
            document.getElementById("rolesError").classList.add("show");
            showErrorMessage("‚ö†Ô∏è Velg minst √©n rolle (PM, AC eller KAM)");
            return;
          }

          document.getElementById("rolesError").classList.remove("show");

          const submitBtn = document.getElementById("submitBtn");
          submitBtn.disabled = true;
          submitBtn.textContent = "‚è≥ Legger til...";

          try {
            const activityData = {
              date: document.getElementById("date").value,
              customer: document.getElementById("customer").value.trim(),
              pm: pmValue || null,
              ac: acValue || null,
              kam: kamValue || null,
              activityType: parseInt(document.getElementById("activity").value),
              points: parseInt(document.getElementById("activity").value),
              timestamp: new Date().toISOString(),
              createdAt: new Date(),
            };

            console.log("Adding activity:", activityData);

            // Add to Firestore
            await addDoc(collection(db, "activities"), activityData);

            // Reset form
            this.reset();
            document.getElementById("date").valueAsDate = new Date();
            ["pm", "ac", "kam"].forEach((id) => {
              document.getElementById(id).classList.remove("selected");
            });

            showSuccessMessage("‚úÖ Aktivitet lagt til!");
          } catch (error) {
            console.error("Error adding activity:", error);
            showErrorMessage("‚ùå Feil ved lagring: " + error.message);
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = "‚ûï Legg til aktivitet";
          }
        });

      // Delete activity
      window.deleteActivity = async function (id) {
        if (confirm("Er du sikker p√• at du vil slette denne aktiviteten?")) {
          try {
            await deleteDoc(doc(db, "activities", id));
            showSuccessMessage("üóëÔ∏è Aktivitet slettet");
          } catch (error) {
            console.error("Error deleting:", error);
            showErrorMessage("‚ùå Feil ved sletting");
          }
        }
      };

      // ‚Üê L√ÑGG TILL DETTA!
      window.loadMoreActivities = function () {
        currentPage++;
        updateActivityLog();
        document
          .getElementById("activityLog")
          .scrollIntoView({ behavior: "smooth", block: "nearest" });
      };

      function showSuccessMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "success-message";
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }

      function showErrorMessage(message) {
        const messageDiv = document.createElement("div");
        messageDiv.className = "error-message";
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, 5000);
      }

      function calculateLeaderboard(role) {
        const scores = {};

        activities.forEach((activity) => {
          const person = activity[role];
          if (person) {
            scores[person] = (scores[person] || 0) + activity.points;
          }
        });

        return Object.entries(scores)
          .sort((a, b) => b[1] - a[1])
          .map(([name, points]) => ({ name, points }));
      }

      function updateLeaderboard(role, elementId) {
        const leaderboard = calculateLeaderboard(role);
        const element = document.getElementById(elementId);

        if (leaderboard.length === 0) {
          element.innerHTML =
            '<p style="color: #999; text-align: center; padding: 20px;">Ingen data enn√•...</p>';
          return null;
        }

        element.innerHTML = leaderboard
          .map(
            (item, index) => `
            <div class="leaderboard-item ${index === 0 ? "winner" : ""}">
                <span class="name">
                    ${index === 0 ? '<span class="trophy">ü•á</span>' : ""}
                    ${index === 1 ? '<span class="trophy">ü•à</span>' : ""}
                    ${index === 2 ? '<span class="trophy">ü•â</span>' : ""}
                    ${item.name}
                </span>
                <span class="points">${item.points} poeng</span>
            </div>
        `,
          )
          .join("");

        return leaderboard[0] || null;
      }

      function updateWinners() {
        const pmWinner = updateLeaderboard("pm", "pmLeaderboard");
        const acWinner = updateLeaderboard("ac", "acLeaderboard");
        const kamWinner = updateLeaderboard("kam", "kamLeaderboard");

        document.getElementById("pmWinner").textContent = pmWinner
          ? pmWinner.name
          : "-";
        document.getElementById("pmWinnerPoints").textContent = pmWinner
          ? `${pmWinner.points} poeng`
          : "0 poeng";

        document.getElementById("acWinner").textContent = acWinner
          ? acWinner.name
          : "-";
        document.getElementById("acWinnerPoints").textContent = acWinner
          ? `${acWinner.points} poeng`
          : "0 poeng";

        document.getElementById("kamWinner").textContent = kamWinner
          ? kamWinner.name
          : "-";
        document.getElementById("kamWinnerPoints").textContent = kamWinner
          ? `${kamWinner.points} poeng`
          : "0 poeng";
      }

      function updateStats() {
        const totalPoints = activities.reduce((sum, a) => sum + a.points, 0);
        const uniqueCustomers = [...new Set(activities.map((a) => a.customer))]
          .length;
        const endDate = new Date("2026-03-31");
        const today = new Date();
        const daysLeft = Math.max(
          0,
          Math.ceil((endDate - today) / (1000 * 60 * 60 * 24)),
        );

        document.getElementById("totalPoints").textContent = totalPoints;
        document.getElementById("totalActivities").textContent =
          activities.length;
        document.getElementById("totalCustomers").textContent = uniqueCustomers;
        document.getElementById("daysLeft").textContent = daysLeft;
      }

      function getActivityColor(points) {
        const colors = {
          1: "#17a2b8", // Cyan
          2: "#ffc107", // Gul
          3: "#28a745", // Gr√∂n
        };
        return colors[points] || "#667eea";
      }

      // Pagination variables
      let currentPage = 1;
      const activitiesPerPage = 9; // 3 rader x 3 kolumner

      function updateActivityLog() {
        const element = document.getElementById("activityLog");
        const showMoreContainer = document.getElementById("showMoreContainer");
        const paginationInfo = document.getElementById("paginationInfo");

        if (activities.length === 0) {
          element.innerHTML =
            '<p style="color: #999; text-align: center; padding: 20px;">Ingen aktiviteter enn√•... V√¶r den f√∏rste til √• legge til!</p>';
          showMoreContainer.style.display = "none";
          paginationInfo.textContent = "";
          return;
        }

        const totalActivities = activities.length;
        const totalPages = Math.ceil(totalActivities / activitiesPerPage);
        const startIndex = 0;
        const endIndex = currentPage * activitiesPerPage;
        const visibleActivities = activities.slice(startIndex, endIndex);

        // Update pagination info
        paginationInfo.textContent = `Viser ${visibleActivities.length} av ${totalActivities} aktiviteter`;

        // Create grid HTML
        element.innerHTML = `
          <div class="activity-grid">
            ${visibleActivities
              .map((activity) => {
                const roles = [];
                if (activity.pm)
                  roles.push(`<strong>PM:</strong> ${activity.pm}`);
                if (activity.ac)
                  roles.push(`<strong>AC:</strong> ${activity.ac}`);
                if (activity.kam)
                  roles.push(`<strong>KAM:</strong> ${activity.kam}`);

                const rolesText =
                  roles.length > 0
                    ? roles.join("<br>")
                    : '<em style="color: #999;">Ingen roller registrert</em>';

                const dateFormatted = new Date(
                  activity.date,
                ).toLocaleDateString("no-NO", {
                  weekday: "short",
                  day: "2-digit",
                  month: "short",
                  year: "numeric",
                });

                return `
                  <div class="activity-item" style="border-left-color: ${getActivityColor(activity.points)};">
                    <div class="date">üìÖ ${dateFormatted}</div>
                    <div class="customer" title="${activity.customer}">üè¢ ${activity.customer}</div>
                    <div class="roles">
                      üë• ${rolesText}
                    </div>
                    <div class="details">
                      üìå ${activityDescriptions[activity.activityType]}
                      <span class="points-badge" style="background-color: ${getActivityColor(activity.points)}; color: white;">
                        +${activity.points}p
                      </span>
                    </div>
                    <button class="delete-btn" onclick="deleteActivity('${activity.id}')">üóëÔ∏è Slett</button>
                  </div>
                `;
              })
              .join("")}
          </div>
        `;

        // Show/hide "Vis mer" button
        if (endIndex >= totalActivities) {
          showMoreContainer.style.display = "none";
        } else {
          showMoreContainer.style.display = "block";
          document.getElementById("showMoreBtn").textContent =
            `Vis flere aktiviteter +(${totalActivities - endIndex}) ‚Üí`;
        }
      }

      function loadMoreActivities() {
        currentPage++;
        updateActivityLog();
        // Scroll to newly loaded activities
        document
          .getElementById("activityLog")
          .scrollIntoView({ behavior: "smooth", block: "nearest" });
      }

      // Reset pagination when activities change
      function resetPagination() {
        currentPage = 1;
      }

      function updateAll() {
        updateWinners();
        updateStats();
        updateActivityLog();
      }

      console.log("App initialized with Firebase");
    </script>
  </body>
</html>
